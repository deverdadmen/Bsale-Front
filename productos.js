const produc = [{"id":5,"name":"ENERGETICA MR BIG","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/misterbig3308256.jpg","price":1490,"discount":20,"category":1},{"id":6,"name":"ENERGETICA RED BULL","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/redbull8381.jpg","price":1490,"discount":0,"category":1},{"id":7,"name":"ENERGETICA SCORE","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/logo7698.png","price":1290,"discount":0,"category":1},{"id":8,"name":"PISCO ALTO DEL CARMEN 35º","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/alto8532.jpg","price":7990,"discount":10,"category":2},{"id":9,"name":"PISCO ALTO DEL CARMEN 40º ","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/alto408581.jpg","price":5990,"discount":0,"category":2},{"id":10,"name":"PISCO ARTESANOS 35º ","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/artesanos8818.jpg","price":3990,"discount":0,"category":2},{"id":11,"name":"PISCO BAUZA 40º ","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/bauza408831.jpg","price":4990,"discount":0,"category":2},{"id":12,"name":"PISCO CAMPANARIO 35º","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/campanario8845.jpg","price":2990,"discount":20,"category":2},{"id":13,"name":"PISCO CAMPANARIO 40º","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/campanario408881.jpg","price":3990,"discount":20,"category":2},{"id":14,"name":"PISCO ESPIRITU DEL ELQUI 40º","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/espiritu8936.jpg","price":5990,"discount":20,"category":2},{"id":15,"name":"PISCO ESPIRITU DEL ELQUI 45º","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/espiritu8957.jpg","price":6990,"discount":5,"category":2},{"id":16,"name":"PISCO HORCON QUEMADO 35º","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/horcon359049.jpg","price":6990,"discount":20,"category":2},{"id":17,"name":"PISCO HORCON QUEMADO 40º","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/horcon409062.jpg","price":7990,"discount":20,"category":2},{"id":18,"name":"PISCO HORCON QUEMADO 46º","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/horcon469075.jpg","price":8990,"discount":20,"category":2},{"id":19,"name":"PISCO MISTRAL 35º","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/mistral359200.jpg","price":4990,"discount":20,"category":2},{"id":20,"name":"PISCO MISTRAL 40º ","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/mistral409215.jpg","price":4990,"discount":20,"category":2},{"id":21,"name":"PISCO TRES ERRES 35º","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/rrr359305.jpg","price":4590,"discount":20,"category":2},{"id":22,"name":"PISCO TRES ERRES 40º","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/rrr409319.jpg","price":4990,"discount":20,"category":2},{"id":23,"name":"RON BACARDI AÑEJO","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/bacardi9450.jpg","price":4990,"discount":0,"category":3},{"id":24,"name":"RON BACARDI 8 AÑOS","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/bacardianejo9463.jpg","price":5990,"discount":0,"category":3},{"id":25,"name":"RON ABUELO","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/abuelo9475.jpg","price":3990,"discount":0,"category":3},{"id":26,"name":"RON BARCELO AÑEJO","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/barceloanejo9553.jpg","price":4990,"discount":0,"category":3},{"id":27,"name":"RON BARCELO DORADO","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/barcelodorado9567.jpg","price":3990,"discount":0,"category":3},{"id":28,"name":"RON FLOR DE CAÑA 4 AÑOS","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/flor49664.jpg","price":3990,"discount":0,"category":3},{"id":29,"name":"RON FLOR DE CAÑA 5 AÑOS","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/flor59677.jpg","price":4590,"discount":0,"category":3},{"id":30,"name":"RON HAVANA AÑEJO RESERVA","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/havanaan-ejo9750.jpg","price":6990,"discount":0,"category":3},{"id":31,"name":"RON HAVANA ESPECIAL","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/havanaespecial9768.jpg","price":5990,"discount":20,"category":3},{"id":32,"name":"RON PAMPERO","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/pampero-especial0296.jpg","price":5490,"discount":20,"category":3},{"id":33,"name":"RON PAMPERO ANIVERSARIO","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/ron_pampero_aniversario0311.jpg","price":20000,"discount":15,"category":3},{"id":34,"name":"ENERGETICA MONSTER RIPPER","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/mosterriper0436.jpg","price":1990,"discount":0,"category":1},{"id":35,"name":"ENERGETICA MAKKA DRINKS","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/makka-drinks-250ml0455.jpg","price":1190,"discount":0,"category":1},{"id":36,"name":"ENERGETICA MONSTER VERDE","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/monsterverde0476.jpg","price":1990,"discount":0,"category":1},{"id":37,"name":"COCA COLA ZERO DESECHABLE","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/cocazero9766.jpg","price":1490,"discount":0,"category":4},{"id":38,"name":"RON BOTRAN AÑEJO 5 AÑOS","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/ronbotran9337.jpg","price":4990,"discount":0,"category":3},{"id":39,"name":"RON MITJANS","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/mitjan6396.jpg","price":2990,"discount":0,"category":3},{"id":47,"name":"Maní salado","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/manisaladomp4415.jpg","price":600,"discount":0,"category":5},{"id":48,"name":"SPRITE 1 1/2 Lts","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/sprite-lata-33cl5575.jpg","price":1500,"discount":0,"category":4},{"id":50,"name":"SPRITE 2 Lt","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/sprite-2lt4365.jpg","price":1800,"discount":0,"category":4},{"id":52,"name":"Fanta","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/fanta_2lt5236.jpg","price":1500,"discount":0,"category":4},{"id":53,"name":"Mani Sin Sal","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/manisinsalmp6988.jpg","price":500,"discount":0,"category":5},{"id":54,"name":"Papas Fritas Lisas Bolsa Grande","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/papaslisasgrande7128.jpg","price":1490,"discount":0,"category":5},{"id":55,"name":"Papas Fritas Bolsa Pequeña","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/papaslisas7271.jpg","price":500,"discount":0,"category":5},{"id":56,"name":"Papas Fritas Tarro","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/78028005335657432.jpg","price":1990,"discount":0,"category":5},{"id":57,"name":"COCA COLA NORMAL DESECHABLE 1500cc","url_image":null,"price":1500,"discount":0,"category":4},{"id":58,"name":"COCA COLA LIGHT DESECHABLE","url_image":null,"price":1500,"discount":0,"category":4},{"id":68,"name":"Bebida Sprite 1 Lt","url_image":null,"price":1250,"discount":10,"category":4},{"id":77,"name":"ENERGETICA MONSTER RIPPER","url_image":"","price":1990,"discount":0,"category":1},{"id":79,"name":"ENERGETICA MONSTER VERDE","url_image":"","price":1990,"discount":0,"category":1},{"id":87,"name":"PISCO MISTRAL 35°","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/358978.jpg","price":4990,"discount":0,"category":2},{"id":88,"name":"PISCO MISTRAL GRAN NOBEL 40°","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/grannobel9104.jpg","price":19900,"discount":0,"category":2},{"id":89,"name":"PISCO MISTRAL 40°","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/409346.jpg","price":4990,"discount":0,"category":2},{"id":90,"name":"PISCO MISTRAL 46°","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/469463.jpg","price":7890,"discount":0,"category":2},{"id":91,"name":"PISCO MISTRAL NOBEL 40°","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/nobel409551.jpg","price":19990,"discount":0,"category":2},{"id":92,"name":"PISCO MISTRAL NOBEL 46","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/nobelanejado9639.jpg","price":15990,"discount":15,"category":2},{"id":98,"name":"Cerveza Escudo Normal LATA 350CC","url_image":"","price":600,"discount":0,"category":6},{"id":99,"name":"Cerveza Escudo Sin Filtrar LATA 350CC","url_image":"","price":800,"discount":0,"category":6},{"id":104,"name":"ABSOLUT","url_image":"https://dojiw2m9tvv09.cloudfront.net/11132/product/absolut21381.png","price":8990,"discount":30,"category":7}]
let lista = []
let aux = []
let filtro = ''








  // State
// Number of products
let numberOfItems = 0
const numberPerPage = 12
const currentPage = 1

// Number of pages
let numberOfPages = 0

function accomodatePage(clickedPage) {
    if (clickedPage <= 1) { return clickedPage + 1}
    if (clickedPage >= numberOfPages) { return clickedPage -1}
    return clickedPage
}

function buildPagination(clickedPage) {
    $('.paginator').empty()
    const currPageNum = accomodatePage(clickedPage)
    if (numberOfPages >= 10) {
        for (let i=-1; i<10; i++) {
            $('.paginator').append(`<button class="btn btn-light" value="${currPageNum+i}">${currPageNum+i}</button>`)
        }
    } else {
        for (let i=0; i<numberOfPages; i++) {
            $('.paginator').append(`<button class="btn btn-light" value="${i+1}">${i+1}</button>`)
        }
    }
}

function buildPage(currPage) {
    const trimStart = (currPage-1)*numberPerPage
    const trimEnd = trimStart + numberPerPage
    $('#galeria').empty().append(lista.slice(trimStart, trimEnd))
}

function cargaLista(array){
    lista = []
    array.forEach(function(producto){
        if(producto.discount > 0){
            var final =  producto.price - Math.round( (producto.discount / 100) * producto.price )
            lista.push(`
            <div class="card" style="width: 18rem;">
            <img src="${producto.url_image}" class="card-img-top" alt="..." style="max-width: 280px;">
            <div class="card-header" style=" background-color: #ffffff">
                <h6 class="card-title">${producto.name}</h6>
            </div>
            <div class="card-body">
                <p class="card-text"> <span style="text-decoration:line-through;">$${producto.price} </span>$${final}   <img src="cart-shopping-solid.svg" alt="" style="float:right; color: black; width: 20px; height: 20px; "></p>
            </div>
            </div>
          `) 
        }else{
            lista.push(`
            <div class="card" style="width: 18rem;">
            <img src="${producto.url_image}" class="card-img-top" alt="..." style="max-width: 280px;">
            <div class="card-header" style=" background-color: #ffffff">
                <h6 class="card-title">${producto.name}</h6>
            </div>
            <div class="card-body">
                <p class="card-text">$${producto.price} <img src="cart-shopping-solid.svg" alt="" style="float:right; color: black; width: 20px; height: 20px; "></p>
            </div>
            </div>
          `) 
        }
        
      });
      numberOfItems = lista.length
      numberOfPages = Math.ceil(numberOfItems/numberPerPage)
      buildPage(1)
      buildPagination(currentPage)
}

function cargarCat(array){
    $('.dropdown-menu').empty()
    $('.dropdown-menu').append(`<li><a class="dropdown-item" onclick="seccionar(this)">Todos los Productos</a></li>`)
    array.forEach(function(categoria){
        $('.dropdown-menu').append(`<li><a class="dropdown-item" onclick="seccionar(this)">${categoria.name}</a></li>`)
    });

}

function seccionar(){
    console.log(filtro)
    //filtrarCategoria(filtro);

}

$(document).ready(function(){
    consultarCategorias()
    consultarProductos()
    
    $('.paginator').on('click', 'button', function() {
        var clickedPage = parseInt($(this).val())
        buildPagination(clickedPage)
        console.log(`Page clicked on ${clickedPage}`)
        buildPage(clickedPage)
    });

    // $("#categorias").change(function(){
    //     console.log($('#categorias').val());
    //     filtro = $('#categorias').val();
    //     if(busqueda == 'all'){
    //         //cargaLista(productos);
    //         consultarProductos()
    //     }else{
    //         filtrarCategoria(filtro)
    //         // aux = productos.filter( cat => cat.category == busqueda);
    //         // cargaLista(aux)
    //     }
    // });

    $("#ordenar").change(function(){
        console.log($('#ordenar').val());
        orden = $('#ordenar').val();

        switch(orden){
            case 'menor':
                ordenarMenor()
            break;
            case 'mayor':
                ordenarMayor()
            break;
            case 'descuento':
                ordenarDescuento()
            break;
            case 'alfabetico':
                ordenarAlfabetico()
            break;

        }

    });

    $("#busqueda").on("click",function(event){
        event.preventDefault();
        var buscado = document.getElementById('formulario') ;
        buscarProductos(buscado.value)
        console.log(buscado)
        buscado.value = "";
     });

});

function seccionar(_this){

    if( _this.textContent == 'Todos los Productos'){
        allProduct()
    }else{
        console.log(_this.textContent)
        filtro = _this.textContent;
        filtrarCategoria(filtro);
    }
    
}

function allProduct(){
    filtro = 'all'
    consultarProductos()
}

// funcion para Cargar Provincias al campo <select>
function cargarCategorias(array) {   
    array.sort();
    addOptions("categorias", array);
   }
   
   // Rutina para agregar opciones a un <select>
   function addOptions(domElement, array) {
    var select = document.getElementsByName(domElement)[0];
   
    for (value in array) {
     var option = document.createElement("option");
     option.text = array[value].name;
     option.value = array[value].name;
     select.add(option);
    }
   }


//    function ordenar(modo) {
//     switch (modo) {
//       case 'mayor':
//         this.listado.sort(compararMayor);
//         this.confiPaginas();
//         return this.listado;
//       case 'menor':
//         this.listado.sort(compararMenor);
//         this.confiPaginas();
//         return this.listado;
//       case 'alfabetico':
//         this.listado.sort(compararAbc);
//         this.confiPaginas();
//         return this.listado;
//       default:
//         break;
//     }
//   }

//    function compararMayor(a, b) {
//     return b.valor - a.valor;
//   }
//   function compararMenor(a, b) {
//     return a.valor - b.valor;
//   }
//   function compararAbc(a, b) {
//     return a.nombre.localeCompare(b.nombre);
//   }
